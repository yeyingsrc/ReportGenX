# å…¥ä¾µç—•è¿¹æŠ¥å‘Šæ¨¡æ¿ Schema
# Template: intrusion_report
# Version: 1.0.0

id: intrusion_report
name: å…¥ä¾µç—•è¿¹æŠ¥å‘Š
description: ç”¨äºè®°å½•å’ŒæŠ¥å‘Šç³»ç»Ÿå…¥ä¾µç—•è¿¹çš„åˆ†ææŠ¥å‘Šæ¨¡æ¿
version: "1.0.0"
order: 2
icon: ""
author: ReportGenX Team
create_time: "2026-01-26"
update_time: "2026-01-26"

# æ¨¡æ¿æ–‡ä»¶ (ç›¸å¯¹äºæ¨¡æ¿ç›®å½•)
template_file: template.docx

# å­—æ®µåˆ†ç»„å®šä¹‰
field_groups:
  - id: basic
    name: åŸºç¡€ä¿¡æ¯
    icon: "ğŸ“‹"
    order: 1
    
  - id: target
    name: å—å®³ä¸»æœºä¿¡æ¯
    icon: "ğŸ–¥ï¸"
    order: 2
    
  - id: intrusion
    name: å…¥ä¾µç—•è¿¹è¯¦æƒ…
    icon: "ğŸ”"
    order: 3
    
  - id: timeline
    name: æ—¶é—´çº¿åˆ†æ
    icon: "â±ï¸"
    order: 4
    
  - id: evidence
    name: è¯æ®æˆªå›¾
    icon: "ğŸ“·"
    order: 5

# æ•°æ®æºå®šä¹‰
data_sources:
  - id: intrusion_types
    type: config
    description: å…¥ä¾µç±»å‹åˆ—è¡¨
    config_key: intrusion_types
    
  - id: vulnerabilities
    type: database
    description: æ¼æ´åº“æ•°æ®
    
  - id: severity_levels
    type: config
    description: ä¸¥é‡ç­‰çº§
    config_key: severity_levels
    
  - id: unit_types
    type: config
    description: å•ä½ç±»å‹
    config_key: unitType
    
  - id: industries
    type: config
    description: æ‰€å±è¡Œä¸š
    config_key: industry

# å­—æ®µå®šä¹‰
fields:
  # ===== åŸºç¡€ä¿¡æ¯ç»„ =====
  - key: report_id
    label: æŠ¥å‘Šç¼–å·
    type: text
    required: true
    group: basic
    order: 1
    readonly: true
    auto_generate: true
    auto_generate_rule: "RQBG-{date:YYYYMMDD}-{seq:4}"
    placeholder: è‡ªåŠ¨ç”Ÿæˆ
    help_text: ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸º RQBG-æ—¥æœŸ-åºå·
    template_placeholder: "#report_id#"
    
  - key: intrusion_type
    label: å…¥ä¾µç±»å‹
    type: select
    required: true
    group: basic
    order: 2
    source: intrusion_types
    options:
      - value: webshell
        label: Webshellæ¤å…¥
      - value: backdoor
        label: åé—¨ç¨‹åº
      - value: malware
        label: æ¶æ„è½¯ä»¶
      - value: data_theft
        label: æ•°æ®çªƒå–
      - value: privilege_escalation
        label: æƒé™æå‡
      - value: lateral_movement
        label: æ¨ªå‘ç§»åŠ¨
      - value: crypto_mining
        label: æŒ–çŸ¿æœ¨é©¬
      - value: ransomware
        label: å‹’ç´¢è½¯ä»¶
      - value: other
        label: å…¶ä»–
    template_placeholder: "#intrusion_type#"
    
  - key: severity_level
    label: ä¸¥é‡ç­‰çº§
    type: select
    required: true
    group: basic
    order: 3
    source: config.risk_levels
    computed: true
    compute_from: intrusion_type
    compute_rule:
      webshell: é«˜å±
      backdoor: è¶…å±
      malware: é«˜å±
      data_theft: è¶…å±
      privilege_escalation: é«˜å±
      lateral_movement: è¶…å±
      crypto_mining: ä¸­å±
      ransomware: è¶…å±
      other: ä¸­å±
    template_placeholder: "#severity_level#"
    
  - key: discovery_time
    label: å‘ç°æ—¶é—´
    type: text
    required: true
    group: basic
    order: 4
    default: today
    placeholder: "YYYY-MM-DD HH:mm"
    template_placeholder: "#discovery_time#"
    
  - key: report_time
    label: æŠ¥å‘Šæ—¶é—´
    type: text
    required: true
    group: basic
    order: 5
    default: today
    template_placeholder: "#report_time#"
    
  - key: analyst_name
    label: åˆ†æäººå‘˜
    type: text
    required: true
    group: basic
    order: 6
    source: config.supplierName
    editable_config: true
    template_placeholder: "#analyst_name#"

  - key: supplier_name
    label: æŠ€æœ¯æ”¯æŒå•ä½
    type: text
    group: basic
    order: 7
    required: false
    source: config.supplierName
    editable_config: true
    save_to_config: true
    template_placeholder: "#supplierName#"

  # ===== å—å®³ä¸»æœºä¿¡æ¯ç»„ =====
  - key: victim_ip
    label: å—å®³ä¸»æœºIP
    type: text
    required: true
    group: target
    order: 1
    placeholder: "192.168.1.100"
    template_placeholder: "#victim_ip#"
    
  - key: victim_hostname
    label: ä¸»æœºåç§°
    type: text
    required: false
    group: target
    order: 2
    template_placeholder: "#victim_hostname#"
    
  - key: victim_os
    label: æ“ä½œç³»ç»Ÿ
    type: select
    required: true
    group: target
    order: 3
    options:
      - Windows Server 2019
      - Windows Server 2016
      - Windows Server 2012
      - Windows 10/11
      - CentOS 7
      - CentOS 8
      - Ubuntu 18.04
      - Ubuntu 20.04
      - Ubuntu 22.04
      - Debian
      - RedHat
      - å…¶ä»–Linux
      - å…¶ä»–
    template_placeholder: "#victim_os#"
    
  - key: victim_service
    label: å—å½±å“æœåŠ¡
    type: text
    required: false
    group: target
    order: 4
    placeholder: "å¦‚: Apache, Nginx, MySQL"
    template_placeholder: "#victim_service#"
    
  - key: unit_name
    label: æ‰€å±å•ä½
    type: text
    required: true
    group: target
    order: 5
    template_placeholder: "#unit_name#"
    
  - key: unit_type
    label: å•ä½ç±»å‹
    type: select
    required: false
    group: target
    order: 6
    source: unit_types
    template_placeholder: "#unit_type#"
    
  - key: industry
    label: æ‰€å±è¡Œä¸š
    type: select
    required: false
    group: target
    order: 7
    source: industries
    template_placeholder: "#industry#"
    
  - key: contact_person
    label: è”ç³»äºº
    type: text
    required: false
    group: target
    order: 8
    template_placeholder: "#contact_person#"
    
  - key: contact_phone
    label: è”ç³»ç”µè¯
    type: text
    required: false
    group: target
    order: 9
    template_placeholder: "#contact_phone#"

  # ===== å…¥ä¾µç—•è¿¹è¯¦æƒ…ç»„ =====
  - key: attack_method
    label: æ”»å‡»æ‰‹æ³• (ä»æ¼æ´åº“é€‰æ‹©)
    type: searchable_select
    required: false
    group: intrusion
    order: 1
    source: vulnerabilities
    search_placeholder: è¾“å…¥å…³é”®è¯å¿«é€Ÿç­›é€‰æ¼æ´...
    display_field: name
    value_field: id
    help_text: ä»æ¼æ´åº“ä¸­é€‰æ‹©æ”»å‡»æ‰‹æ³•
    template_placeholder: "#attack_method#"
    
  - key: attack_method_custom
    label: è‡ªå®šä¹‰æ”»å‡»æ‰‹æ³•
    type: text
    required: false
    group: intrusion
    order: 1.5
    placeholder: å¦‚æ¼æ´åº“ä¸­æ²¡æœ‰ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ”»å‡»æ‰‹æ³•
    help_text: å¦‚æ¼æ´åº“ä¸­æ²¡æœ‰åˆé€‚çš„é€‰é¡¹ï¼Œå¯ä»¥æ‰‹åŠ¨è¾“å…¥
    
  - key: malware_name
    label: æ¶æ„ç¨‹åºåç§°
    type: text
    required: false
    group: intrusion
    order: 2
    placeholder: "å¦‚å‘ç°æ¶æ„ç¨‹åºï¼Œå¡«å†™åç§°"
    template_placeholder: "#malware_name#"
    
  - key: malware_path
    label: æ¶æ„ç¨‹åºè·¯å¾„
    type: text
    required: false
    group: intrusion
    order: 3
    placeholder: "/var/www/html/shell.php"
    template_placeholder: "#malware_path#"
    
  - key: malware_hash
    label: æ–‡ä»¶Hash (MD5/SHA256)
    type: text
    required: false
    group: intrusion
    order: 4
    placeholder: "32ä½MD5æˆ–64ä½SHA256"
    template_placeholder: "#malware_hash#"
    
  - key: c2_address
    label: C2æœåŠ¡å™¨åœ°å€
    type: text
    required: false
    group: intrusion
    order: 5
    placeholder: "IPæˆ–åŸŸå"
    template_placeholder: "#c2_address#"
    
  - key: intrusion_description
    label: å…¥ä¾µç—•è¿¹æè¿°
    type: textarea
    required: true
    group: intrusion
    order: 6
    rows: 5
    placeholder: "è¯¦ç»†æè¿°å‘ç°çš„å…¥ä¾µç—•è¿¹..."
    template_placeholder: "#intrusion_description#"
    
  - key: impact_assessment
    label: å½±å“è¯„ä¼°
    type: textarea
    required: true
    group: intrusion
    order: 7
    rows: 4
    placeholder: "è¯„ä¼°æ­¤æ¬¡å…¥ä¾µå¯¹ç³»ç»Ÿå’Œä¸šåŠ¡çš„å½±å“..."
    template_placeholder: "#impact_assessment#"
    
  - key: remediation_suggestion
    label: å¤„ç½®å»ºè®®
    type: textarea
    required: true
    group: intrusion
    order: 8
    rows: 4
    placeholder: "æä¾›é’ˆå¯¹æ€§çš„å¤„ç½®å’ŒåŠ å›ºå»ºè®®..."
    template_placeholder: "#remediation_suggestion#"

  # ===== æ—¶é—´çº¿åˆ†æç»„ =====
  - key: first_access_time
    label: é¦–æ¬¡å…¥ä¾µæ—¶é—´
    type: text
    required: false
    group: timeline
    order: 1
    placeholder: "YYYY-MM-DD HH:mm (å¦‚èƒ½ç¡®å®š)"
    template_placeholder: "#first_access_time#"
    
  - key: persistence_time
    label: é©»ç•™æ—¶é•¿
    type: text
    required: false
    group: timeline
    order: 2
    placeholder: "å¦‚: 3å¤©, 2å‘¨"
    template_placeholder: "#persistence_time#"
    
  - key: timeline_detail
    label: æ”»å‡»æ—¶é—´çº¿
    type: textarea
    required: false
    group: timeline
    order: 3
    rows: 6
    placeholder: "æŒ‰æ—¶é—´é¡ºåºæè¿°æ”»å‡»è€…çš„è¡Œä¸ºè½¨è¿¹..."
    template_placeholder: "#timeline_detail#"

  # ===== è¯æ®æˆªå›¾ç»„ =====
  - key: evidence_images
    label: å…¥ä¾µç—•è¿¹æˆªå›¾
    type: image_list
    required: false
    group: evidence
    order: 1
    max_count: 10
    accept: "image/*"
    paste_enabled: true
    with_description: true
    description_placeholder: "æè¿°æ­¤æˆªå›¾å±•ç¤ºçš„å…¥ä¾µç—•è¿¹..."
    
  - key: log_evidence
    label: æ—¥å¿—è¯æ®æˆªå›¾
    type: image_list
    required: false
    group: evidence
    order: 2
    max_count: 5
    accept: "image/*"
    paste_enabled: true
    with_description: true
    description_placeholder: "æè¿°æ—¥å¿—ä¸­å‘ç°çš„å¼‚å¸¸..."

  - key: remarks
    label: å¤‡æ³¨
    type: textarea
    required: false
    group: basic
    order: 10
    rows: 2
    template_placeholder: "#remarks#"

# è¡Œä¸ºå®šä¹‰
behaviors:
  - id: auto_severity
    trigger:
      field: intrusion_type
      event: change
    actions:
      - type: compute
        target: severity_level
        rules:
          webshell: é«˜å±
          backdoor: è¶…å±
          malware: é«˜å±
          data_theft: è¶…å±
          privilege_escalation: é«˜å±
          lateral_movement: è¶…å±
          crypto_mining: ä¸­å±
          ransomware: è¶…å±
          other: ä¸­å±

# éªŒè¯è§„åˆ™
validation:
  rules:
    - fields: [victim_ip, intrusion_type, intrusion_description]
      rule: required
      message: "è¯·å¡«å†™å®Œæ•´çš„å…¥ä¾µç—•è¿¹ä¿¡æ¯"
    - fields: [unit_name]
      rule: required
      message: "è¯·å¡«å†™æ‰€å±å•ä½åç§°"

# è¾“å‡ºé…ç½®
output:
  filename_pattern: "{unit_name}_å…¥ä¾µç—•è¿¹æŠ¥å‘Š_{report_id}_{date}.docx"
  output_dir: "{unit_name}"
  log_to_file: true
  log_pattern: "{date}_intrusion_output.txt"

# é¢„è§ˆé…ç½®
preview:
  title: "å…¥ä¾µç—•è¿¹æŠ¥å‘Šé¢„è§ˆ"
  fields:
    - key: report_id
      label: æŠ¥å‘Šç¼–å·
    - key: intrusion_type
      label: å…¥ä¾µç±»å‹
    - key: severity_level
      label: ä¸¥é‡ç­‰çº§
    - key: victim_ip
      label: å—å®³ä¸»æœºIP
    - key: unit_name
      label: æ‰€å±å•ä½
